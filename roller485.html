<script type="text/javascript">
    RED.nodes.registerType('roller485', {
        category: 'M5Stack',
        color: '#ff9900',
        defaults: {
            name: {value: ""},
            sda: {value: 21, required: true, validate: RED.validators.number()},
            scl: {value: 22, required: true, validate: RED.validators.number()}
        },
        inputs: 1,
        outputs: 1,
        icon: "font-awesome/fa-rotate-right",
        label: function() {
            return this.name || "Roller485";
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        }
    });
</script>

<script type="text/html" data-template-name="roller485">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-sda"><i class="fa fa-microchip"></i> SDA Pin</label>
        <input type="number" id="node-input-sda" placeholder="21">
    </div>
    <div class="form-row">
        <label for="node-input-scl"><i class="fa fa-microchip"></i> SCL Pin</label>
        <input type="number" id="node-input-scl" placeholder="22">
    </div>
</script>

<script type="text/html" data-help-name="roller485">
    <p>M5Stack Roller485 UnitをNode-RED MCU Editionで制御するノードです。</p>
    
    <h3>入力</h3>
    <dl class="message-properties">
        <dt>payload
            <span class="property-type">number</span>
        </dt>
        <dd>回転させる角度(degree)を指定します。-360〜360の範囲で指定してください。</dd>
    </dl>

    <h3>出力</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">object</span></dt>
        <dd>
            <ul>
                <li><code>angle</code> - 設定した角度</li>
                <li><code>status</code> - "ok" または "error"</li>
            </ul>
        </dd>
    </dl>

    <h3>設定</h3>
    <dl class="message-properties">
        <dt>SDA Pin <span class="property-type">number</span></dt>
        <dd>I2CのSDAピン番号(デフォルト: 21)</dd>
        
        <dt>SCL Pin <span class="property-type">number</span></dt>
        <dd>I2CのSCLピン番号(デフォルト: 22)</dd>
    </dl>

    <h3>詳細</h3>
    <p>このノードは、M5Stack Roller485 UnitをI2C経由で制御します。</p>
    <p><code>msg.payload</code>に角度(degree)を数値で渡すと、その角度まで回転します。</p>
    <p>角度は-360度から360度の範囲で指定できます。</p>
    
    <h3>参考</h3>
    <ul>
        <li><a href="https://docs.m5stack.com/ja/unit/Unit-Roller485">Roller485 Unit</a></li>
    </ul>
</script>
